import{j as e}from"./ui-E8jIx32d.js";import{r as i,f as Y,e as Z}from"./vendor-08mqACR8.js";import{u as J,b as h,d as I}from"./data-CNpY1-rC.js";import{B as m}from"./Button-DkVvCag_.js";import{I as ee}from"./Input-Bbjou70d.js";import{T as te}from"./Textarea-Da6oJh8a.js";import{C as S}from"./Card-Kk9NAdVM.js";import{B as M}from"./Badge-BMjbNvha.js";import{z as c,u as se,I as d,U as ae,S as re}from"./index-FHRRNkNB.js";import{i as y}from"./interviewService-u7GG6mGr.js";import{F as ne}from"./ArrowLeftIcon-iBAG5m-G.js";import{F as ie}from"./ClockIcon-sUFCzahK.js";import{F as oe,a as le}from"./StopIcon-BinrObQ-.js";function ce({title:s,titleId:r,...o},l){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:l,"aria-labelledby":r},o),s?i.createElement("title",{id:r},s):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const de=i.forwardRef(ce),me=s=>J({queryKey:["interview",s],queryFn:()=>y.getInterview(s),enabled:!!s}),ue=()=>{const s=h();return I({mutationFn:r=>y.startInterview(r),onSuccess:(r,o)=>{s.invalidateQueries({queryKey:["interview",o]}),s.invalidateQueries({queryKey:["my-interviews"]}),c.success("Interview started")},onError:r=>{c.error(r.message||"Failed to start interview")}})},pe=()=>{const s=h();return I({mutationFn:r=>y.completeInterview(r),onSuccess:(r,o)=>{s.invalidateQueries({queryKey:["interview",o]}),s.invalidateQueries({queryKey:["my-interviews"]}),c.success("Interview completed")},onError:r=>{c.error(r.message||"Failed to complete interview")}})},xe=()=>{const s=h();return I({mutationFn:({id:r,file:o})=>y.uploadRecording(r,o),onSuccess:(r,{id:o})=>{s.invalidateQueries({queryKey:["interview",o]}),c.success("Recording uploaded successfully")},onError:r=>{c.error(r.message||"Failed to upload recording")}})},Re=()=>{var F,P,q,_,U,L,D,K;const{id:s}=Y(),r=Z(),o=h(),{user:l}=se(),{data:t,isLoading:Q,isError:B}=me(s||""),b=ue(),E=pe(),w=xe(),[p,x]=i.useState(null),[$,j]=i.useState(0),[N,C]=i.useState(""),u=i.useMemo(()=>`interview-timer-${s}`,[s]),g=i.useMemo(()=>`interview-notes-${s}`,[s]);i.useEffect(()=>{const a=localStorage.getItem(g);a&&C(a);const n=localStorage.getItem(u);if(n){const f=Number(n);Number.isNaN(f)||x(f)}},[g,u]),i.useEffect(()=>{localStorage.setItem(g,N)},[N,g]),i.useEffect(()=>{if(!p)return;const a=setInterval(()=>{j(Date.now()-p)},1e3);return()=>clearInterval(a)},[p]),i.useEffect(()=>{t&&t.status!==d.IN_PROGRESS&&(x(null),j(0),localStorage.removeItem(u))},[t,u]);const R=(l==null?void 0:l.role)===ae.INTERVIEWER,A=((F=t==null?void 0:t.jobSeeker)==null?void 0:F._id)||((P=t==null?void 0:t.jobSeekerId)==null?void 0:P._id)||(t==null?void 0:t.jobSeekerId),O=((q=t==null?void 0:t.interviewer)==null?void 0:q._id)||((_=t==null?void 0:t.interviewerId)==null?void 0:_._id)||(t==null?void 0:t.interviewerId),T=t?A===(l==null?void 0:l._id)||O===(l==null?void 0:l._id):!1,v=(t==null?void 0:t.videoRecording)||(t==null?void 0:t.recording),H=a=>{const n=Math.floor(a/1e3),f=Math.floor(n/3600),V=Math.floor(n%3600/60),X=n%60;return`${f.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}:${X.toString().padStart(2,"0")}`},W=async()=>{if(s)try{await b.mutateAsync(s);const a=Date.now();x(a),localStorage.setItem(u,String(a))}catch(a){c.error((a==null?void 0:a.message)||"Unable to start interview")}},z=async()=>{if(s)try{await E.mutateAsync(s),x(null),j(0),localStorage.removeItem(u),c.success("Interview marked completed")}catch(a){c.error((a==null?void 0:a.message)||"Unable to complete interview")}},G=async a=>{if(!(!a||!s))try{await w.mutateAsync({id:s,file:a}),c.success("Recording uploaded"),o.invalidateQueries({queryKey:["interview",s]})}catch(n){c.error((n==null?void 0:n.message)||"Upload failed")}};if(Q)return e.jsx("div",{className:"p-6",children:e.jsx(re,{size:"lg"})});if(B||!t)return e.jsxs("div",{className:"p-6",children:[e.jsx(m,{onClick:()=>r(-1),children:"Back"}),e.jsx("p",{className:"mt-4 text-red-600",children:"Interview not found."})]});if(!T)return e.jsxs("div",{className:"p-6",children:[e.jsx(m,{onClick:()=>r(-1),children:"Back"}),e.jsx("p",{className:"mt-4 text-red-600",children:"You do not have access to this interview."})]});const k={[d.REQUESTED]:{variant:"gray",label:"Requested"},[d.SCHEDULED]:{variant:"primary",label:"Scheduled"},[d.IN_PROGRESS]:{variant:"warning",label:"In Progress"},[d.COMPLETED]:{variant:"success",label:"Completed"},[d.CANCELLED]:{variant:"danger",label:"Cancelled"},[d.NO_SHOW]:{variant:"gray",label:"No Show"},[d.EXPIRED]:{variant:"gray",label:"Expired"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(m,{variant:"outline",onClick:()=>r(-1),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Interview Panel"}),e.jsx(M,{variant:k[t.status].variant,children:k[t.status].label})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Candidate"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[(U=t.jobSeeker)==null?void 0:U.firstName," ",(L=t.jobSeeker)==null?void 0:L.lastName]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Interviewer"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[(D=t.interviewer)==null?void 0:D.firstName," ",(K=t.interviewer)==null?void 0:K.lastName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-mono text-lg",children:p?H($):"00:00:00"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[R&&t.status===d.SCHEDULED&&e.jsxs(m,{onClick:W,isLoading:b.isPending,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Start Interview"]}),R&&t.status===d.IN_PROGRESS&&e.jsxs(m,{variant:"outline",onClick:z,isLoading:E.isPending,children:[e.jsx(le,{className:"h-4 w-4 mr-1"}),"Mark Complete"]}),e.jsx(m,{variant:"outline",onClick:()=>o.invalidateQueries({queryKey:["interview",s]}),children:"Refresh"})]}),e.jsxs("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold mb-1",children:"Call Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This panel doesnâ€™t use an external provider. Coordinate a voice/video call using your preferred internal method, and use this panel to track status, timing, notes, and upload the recording to the system."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(S,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Notes"}),e.jsx(M,{variant:"gray",children:"Local-only"})]}),e.jsx(te,{rows:10,value:N,onChange:a=>C(a.target.value),placeholder:"Write notes, feedback, or action items..."})]}),e.jsxs(S,{className:"space-y-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Recording Upload"}),e.jsx("p",{className:"text-sm text-gray-600",children:"After your session, upload the call recording. It will be stored securely (S3) and attached to this interview."}),e.jsx(ee,{type:"file",accept:"video/*",onChange:a=>{var n;return G((n=a.target.files)==null?void 0:n[0])},disabled:w.isPending}),w.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(de,{className:"h-4 w-4"}),"Uploading..."]}),(v==null?void 0:v.url)&&e.jsx(m,{variant:"outline",onClick:()=>window.open(v.url,"_blank"),children:"View Current Recording"})]})]})]})};export{Re as default};
