{"version":3,"file":"useAuth-C5MDDvFB.js","sources":["../../src/hooks/useAuth.ts"],"sourcesContent":["import { useMutation, useQueryClient } from '@tanstack/react-query';\nimport { useNavigate } from 'react-router-dom';\nimport toast from 'react-hot-toast';\nimport { authService, RegisterData, LoginData } from '@/services/authService';\nimport { useAuthStore } from '@/store/authStore';\n\nexport const useAuth = () => {\n  const navigate = useNavigate();\n  const queryClient = useQueryClient();\n  const { setAuth, logout: logoutStore, isAuthenticated, user } = useAuthStore();\n\n  // Register mutation\n  const registerMutation = useMutation({\n    mutationFn: (data: RegisterData) => authService.register(data),\n    onSuccess: (response) => {\n      let tokens = { accessToken: response.accessToken, refreshToken: response.refreshToken };\n      setAuth(response.user, tokens);\n      toast.success('Registration successful!');\n      \n      // Redirect based on role\n      switch (response.user.role) {\n        case 'job_seeker':\n          navigate('/dashboard/profile?onboarding=1');\n          break;\n        case 'employer':\n          navigate('/dashboard/company');\n          break;\n        case 'interviewer':\n          navigate('/dashboard/interviewer-profile');\n          break;\n        default:\n          navigate('/dashboard');\n      }\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || 'Registration failed');\n    },\n  });\n\n  // Login mutation\n  const loginMutation = useMutation({\n    mutationFn: (data: LoginData) => authService.login(data),\n    onSuccess: (response) => {\n      console.log('Login response:', response);\n      const tokens = { accessToken: response.accessToken, refreshToken: response.refreshToken };\n      setAuth(response.user, tokens);\n      toast.success('Welcome back!');\n      \n      // Redirect based on role\n      switch (response.user.role) {\n        case 'admin':\n          navigate('/admin');\n          break;\n        default:\n          navigate('/dashboard');\n      }\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || 'Login failed');\n    },\n  });\n\n  // Logout mutation\n  const logoutMutation = useMutation({\n    mutationFn: () => authService.logout(),\n    onSuccess: () => {\n      logoutStore();\n      queryClient.clear();\n      toast.success('Logged out successfully');\n      navigate('/');\n    },\n    onError: () => {\n      // Still logout even if API call fails\n      logoutStore();\n      queryClient.clear();\n      navigate('/');\n    },\n  });\n\n  // Change password mutation\n  const changePasswordMutation = useMutation({\n    mutationFn: (data: { currentPassword: string; newPassword: string }) =>\n      authService.changePassword(data),\n    onSuccess: () => {\n      toast.success('Password changed successfully');\n    },\n    onError: (error: Error) => {\n      toast.error(error.message || 'Failed to change password');\n    },\n  });\n\n  return {\n    // State\n    isAuthenticated,\n    user,\n    \n    // Mutations\n    register: registerMutation.mutate,\n    isRegistering: registerMutation.isPending,\n    \n    login: loginMutation.mutate,\n    isLoggingIn: loginMutation.isPending,\n    \n    logout: logoutMutation.mutate,\n    isLoggingOut: logoutMutation.isPending,\n    \n    changePassword: changePasswordMutation.mutate,\n    isChangingPassword: changePasswordMutation.isPending,\n  };\n};\n"],"names":["useAuth","navigate","useNavigate","queryClient","useQueryClient","setAuth","logoutStore","isAuthenticated","user","useAuthStore","registerMutation","useMutation","data","authService","response","tokens","toast","error","loginMutation","logoutMutation","changePasswordMutation"],"mappings":"yIAMO,MAAMA,EAAU,IAAM,CAC3B,MAAMC,EAAWC,EAAA,EACXC,EAAcC,EAAA,EACd,CAAE,QAAAC,EAAS,OAAQC,EAAa,gBAAAC,EAAiB,KAAAC,CAAA,EAASC,EAAA,EAG1DC,EAAmBC,EAAY,CACnC,WAAaC,GAAuBC,EAAY,SAASD,CAAI,EAC7D,UAAYE,GAAa,CACvB,IAAIC,EAAS,CAAE,YAAaD,EAAS,YAAa,aAAcA,EAAS,YAAA,EAKzE,OAJAT,EAAQS,EAAS,KAAMC,CAAM,EAC7BC,EAAM,QAAQ,0BAA0B,EAGhCF,EAAS,KAAK,KAAA,CACpB,IAAK,aACHb,EAAS,iCAAiC,EAC1C,MACF,IAAK,WACHA,EAAS,oBAAoB,EAC7B,MACF,IAAK,cACHA,EAAS,gCAAgC,EACzC,MACF,QACEA,EAAS,YAAY,CAAA,CAE3B,EACA,QAAUgB,GAAiB,CACzBD,EAAM,MAAMC,EAAM,SAAW,qBAAqB,CACpD,CAAA,CACD,EAGKC,EAAgBP,EAAY,CAChC,WAAaC,GAAoBC,EAAY,MAAMD,CAAI,EACvD,UAAYE,GAAa,CACvB,QAAQ,IAAI,kBAAmBA,CAAQ,EACvC,MAAMC,EAAS,CAAE,YAAaD,EAAS,YAAa,aAAcA,EAAS,YAAA,EAK3E,OAJAT,EAAQS,EAAS,KAAMC,CAAM,EAC7BC,EAAM,QAAQ,eAAe,EAGrBF,EAAS,KAAK,KAAA,CACpB,IAAK,QACHb,EAAS,QAAQ,EACjB,MACF,QACEA,EAAS,YAAY,CAAA,CAE3B,EACA,QAAUgB,GAAiB,CACzBD,EAAM,MAAMC,EAAM,SAAW,cAAc,CAC7C,CAAA,CACD,EAGKE,EAAiBR,EAAY,CACjC,WAAY,IAAME,EAAY,OAAA,EAC9B,UAAW,IAAM,CACfP,EAAA,EACAH,EAAY,MAAA,EACZa,EAAM,QAAQ,yBAAyB,EACvCf,EAAS,GAAG,CACd,EACA,QAAS,IAAM,CAEbK,EAAA,EACAH,EAAY,MAAA,EACZF,EAAS,GAAG,CACd,CAAA,CACD,EAGKmB,EAAyBT,EAAY,CACzC,WAAaC,GACXC,EAAY,eAAeD,CAAI,EACjC,UAAW,IAAM,CACfI,EAAM,QAAQ,+BAA+B,CAC/C,EACA,QAAUC,GAAiB,CACzBD,EAAM,MAAMC,EAAM,SAAW,2BAA2B,CAC1D,CAAA,CACD,EAED,MAAO,CAEL,gBAAAV,EACA,KAAAC,EAGA,SAAUE,EAAiB,OAC3B,cAAeA,EAAiB,UAEhC,MAAOQ,EAAc,OACrB,YAAaA,EAAc,UAE3B,OAAQC,EAAe,OACvB,aAAcA,EAAe,UAE7B,eAAgBC,EAAuB,OACvC,mBAAoBA,EAAuB,SAAA,CAE/C"}