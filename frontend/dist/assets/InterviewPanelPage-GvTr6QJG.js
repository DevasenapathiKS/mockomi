import{j as e}from"./ui-E8jIx32d.js";import{r as n,f as X,e as Y}from"./vendor-08mqACR8.js";import{u as J,b as f,d as I}from"./data-CNpY1-rC.js";import{B as m}from"./Button-DkVvCag_.js";import{I as ee}from"./Input-Bbjou70d.js";import{T as te}from"./Textarea-Da6oJh8a.js";import{C as S}from"./Card-Kk9NAdVM.js";import{B as D}from"./Badge-BMjbNvha.js";import{z as c,u as se,I as d,U as re,S as ae}from"./index-Cjn7xYNH.js";import{i as y}from"./interviewService-BimeJGjX.js";import{F as ne}from"./ArrowLeftIcon-iBAG5m-G.js";import{F as ie}from"./ClockIcon-sUFCzahK.js";import{F as oe}from"./PlayIcon-ChNlugVD.js";function le({title:s,titleId:r,...i},o){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 16.5V9.75m0 0 3 3m-3-3-3 3M6.75 19.5a4.5 4.5 0 0 1-1.41-8.775 5.25 5.25 0 0 1 10.233-2.33 3 3 0 0 1 3.758 3.848A3.752 3.752 0 0 1 18 19.5H6.75Z"}))}const ce=n.forwardRef(le);function de({title:s,titleId:r,...i},o){return n.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:o,"aria-labelledby":r},i),s?n.createElement("title",{id:r},s):null,n.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M5.25 7.5A2.25 2.25 0 0 1 7.5 5.25h9a2.25 2.25 0 0 1 2.25 2.25v9a2.25 2.25 0 0 1-2.25 2.25h-9a2.25 2.25 0 0 1-2.25-2.25v-9Z"}))}const me=n.forwardRef(de),ue=s=>J({queryKey:["interview",s],queryFn:()=>y.getInterview(s),enabled:!!s}),pe=()=>{const s=f();return I({mutationFn:r=>y.startInterview(r),onSuccess:(r,i)=>{s.invalidateQueries({queryKey:["interview",i]}),s.invalidateQueries({queryKey:["my-interviews"]}),c.success("Interview started")},onError:r=>{c.error(r.message||"Failed to start interview")}})},ge=()=>{const s=f();return I({mutationFn:r=>y.completeInterview(r),onSuccess:(r,i)=>{s.invalidateQueries({queryKey:["interview",i]}),s.invalidateQueries({queryKey:["my-interviews"]}),c.success("Interview completed")},onError:r=>{c.error(r.message||"Failed to complete interview")}})},xe=()=>{const s=f();return I({mutationFn:({id:r,file:i})=>y.uploadRecording(r,i),onSuccess:(r,{id:i})=>{s.invalidateQueries({queryKey:["interview",i]}),c.success("Recording uploaded successfully")},onError:r=>{c.error(r.message||"Failed to upload recording")}})},Re=()=>{var F,P,q,_,L,U,M,B;const{id:s}=X(),r=Y(),i=f(),{user:o}=se(),{data:t,isLoading:K,isError:Q}=ue(s||""),b=pe(),E=ge(),w=xe(),[p,g]=n.useState(null),[A,j]=n.useState(0),[N,C]=n.useState(""),u=n.useMemo(()=>`interview-timer-${s}`,[s]),x=n.useMemo(()=>`interview-notes-${s}`,[s]);n.useEffect(()=>{const a=localStorage.getItem(x);a&&C(a);const l=localStorage.getItem(u);if(l){const h=Number(l);Number.isNaN(h)||g(h)}},[x,u]),n.useEffect(()=>{localStorage.setItem(x,N)},[N,x]),n.useEffect(()=>{if(!p)return;const a=setInterval(()=>{j(Date.now()-p)},1e3);return()=>clearInterval(a)},[p]),n.useEffect(()=>{t&&t.status!==d.IN_PROGRESS&&(g(null),j(0),localStorage.removeItem(u))},[t,u]);const k=(o==null?void 0:o.role)===re.INTERVIEWER,$=((F=t==null?void 0:t.jobSeeker)==null?void 0:F._id)||((P=t==null?void 0:t.jobSeekerId)==null?void 0:P._id)||(t==null?void 0:t.jobSeekerId),O=((q=t==null?void 0:t.interviewer)==null?void 0:q._id)||((_=t==null?void 0:t.interviewerId)==null?void 0:_._id)||(t==null?void 0:t.interviewerId),T=t?$===(o==null?void 0:o._id)||O===(o==null?void 0:o._id):!1,v=(t==null?void 0:t.videoRecording)||(t==null?void 0:t.recording),W=a=>{const l=Math.floor(a/1e3),h=Math.floor(l/3600),V=Math.floor(l%3600/60),Z=l%60;return`${h.toString().padStart(2,"0")}:${V.toString().padStart(2,"0")}:${Z.toString().padStart(2,"0")}`},H=async()=>{if(s)try{await b.mutateAsync(s);const a=Date.now();g(a),localStorage.setItem(u,String(a))}catch(a){c.error((a==null?void 0:a.message)||"Unable to start interview")}},z=async()=>{if(s)try{await E.mutateAsync(s),g(null),j(0),localStorage.removeItem(u),c.success("Interview marked completed")}catch(a){c.error((a==null?void 0:a.message)||"Unable to complete interview")}},G=async a=>{if(!(!a||!s))try{await w.mutateAsync({id:s,file:a}),c.success("Recording uploaded"),i.invalidateQueries({queryKey:["interview",s]})}catch(l){c.error((l==null?void 0:l.message)||"Upload failed")}};if(K)return e.jsx("div",{className:"p-6",children:e.jsx(ae,{size:"lg"})});if(Q||!t)return e.jsxs("div",{className:"p-6",children:[e.jsx(m,{onClick:()=>r(-1),children:"Back"}),e.jsx("p",{className:"mt-4 text-red-600",children:"Interview not found."})]});if(!T)return e.jsxs("div",{className:"p-6",children:[e.jsx(m,{onClick:()=>r(-1),children:"Back"}),e.jsx("p",{className:"mt-4 text-red-600",children:"You do not have access to this interview."})]});const R={[d.REQUESTED]:{variant:"gray",label:"Requested"},[d.SCHEDULED]:{variant:"primary",label:"Scheduled"},[d.IN_PROGRESS]:{variant:"warning",label:"In Progress"},[d.COMPLETED]:{variant:"success",label:"Completed"},[d.CANCELLED]:{variant:"danger",label:"Cancelled"},[d.NO_SHOW]:{variant:"gray",label:"No Show"},[d.EXPIRED]:{variant:"gray",label:"Expired"}};return e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs(m,{variant:"outline",onClick:()=>r(-1),children:[e.jsx(ne,{className:"h-4 w-4 mr-1"}),"Back"]}),e.jsx("h1",{className:"text-2xl font-semibold text-gray-900",children:"Interview Panel"}),e.jsx(D,{variant:R[t.status].variant,children:R[t.status].label})]}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Candidate"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[(L=t.jobSeeker)==null?void 0:L.firstName," ",(U=t.jobSeeker)==null?void 0:U.lastName]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Interviewer"}),e.jsxs("p",{className:"font-semibold text-gray-900",children:[(M=t.interviewer)==null?void 0:M.firstName," ",(B=t.interviewer)==null?void 0:B.lastName]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-5 w-5 text-gray-500"}),e.jsx("span",{className:"font-mono text-lg",children:p?W(A):"00:00:00"})]})]}),e.jsxs("div",{className:"flex flex-wrap gap-3",children:[k&&t.status===d.SCHEDULED&&e.jsxs(m,{onClick:H,isLoading:b.isPending,children:[e.jsx(oe,{className:"h-4 w-4 mr-1"}),"Start Interview"]}),k&&t.status===d.IN_PROGRESS&&e.jsxs(m,{variant:"outline",onClick:z,isLoading:E.isPending,children:[e.jsx(me,{className:"h-4 w-4 mr-1"}),"Mark Complete"]}),e.jsx(m,{variant:"outline",onClick:()=>i.invalidateQueries({queryKey:["interview",s]}),children:"Refresh"})]}),e.jsxs("div",{className:"rounded-lg border border-dashed border-gray-200 p-4 bg-gray-50",children:[e.jsx("p",{className:"text-sm text-gray-700 font-semibold mb-1",children:"Call Instructions"}),e.jsx("p",{className:"text-sm text-gray-600",children:"This panel doesnâ€™t use an external provider. Coordinate a voice/video call using your preferred internal method, and use this panel to track status, timing, notes, and upload the recording to the system."})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(S,{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Notes"}),e.jsx(D,{variant:"gray",children:"Local-only"})]}),e.jsx(te,{rows:10,value:N,onChange:a=>C(a.target.value),placeholder:"Write notes, feedback, or action items..."})]}),e.jsxs(S,{className:"space-y-3",children:[e.jsx("p",{className:"font-semibold text-gray-900",children:"Recording Upload"}),e.jsx("p",{className:"text-sm text-gray-600",children:"After your session, upload the call recording. It will be stored securely (S3) and attached to this interview."}),e.jsx(ee,{type:"file",accept:"video/*",onChange:a=>{var l;return G((l=a.target.files)==null?void 0:l[0])},disabled:w.isPending}),w.isPending&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-gray-600",children:[e.jsx(ce,{className:"h-4 w-4"}),"Uploading..."]}),(v==null?void 0:v.url)&&e.jsx(m,{variant:"outline",onClick:()=>window.open(v.url,"_blank"),children:"View Current Recording"})]})]})]})};export{Re as default};
