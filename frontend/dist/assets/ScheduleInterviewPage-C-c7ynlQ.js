import{j as e,m as h}from"./ui-E8jIx32d.js";import{r as i,e as pe}from"./vendor-08mqACR8.js";import{b as xe,u as he,d as ee}from"./data-CNpY1-rC.js";import{h as F,i as A,u as ye,z as c}from"./index-Csr_6NQa.js";import{i as se}from"./interviewService-CFGVipFL.js";import{D as ge}from"./DashboardLayout-Crwp17Vt.js";import{B as N}from"./Button-DkVvCag_.js";import{I as te}from"./Input-Bbjou70d.js";import"./Textarea-Da6oJh8a.js";import{C as j}from"./Card-Kk9NAdVM.js";import{F as fe}from"./InformationCircleIcon-BzNmsCGV.js";import{F as we}from"./CheckCircleIcon-DZna7A69.js";import{b as I}from"./XMarkIcon-B-SQiyPX.js";import{F as ve}from"./CurrencyRupeeIcon-qiBkUxPz.js";import{F as _}from"./CheckBadgeIcon-w73AzcaW.js";import{F as re}from"./MagnifyingGlassIcon-DUoGsubn.js";import{F as be}from"./SparklesIcon-BDp_jVkK.js";import{F as je}from"./UsersIcon-hudjBy-f.js";import{F as Ne}from"./CheckCircleIcon-BIxcTuyz.js";import"./useAuth-kxZUTXHI.js";import"./UserIcon-ACflAg1t.js";import"./BuildingOfficeIcon-m0Wh3_We.js";function ke({title:n,titleId:a,...d},r){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},d),n?i.createElement("title",{id:a},n):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M12 9v6m3-3H9m12 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"}))}const D=i.forwardRef(ke);function Ce({title:n,titleId:a,...d},r){return i.createElement("svg",Object.assign({xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",strokeWidth:1.5,stroke:"currentColor","aria-hidden":"true","data-slot":"icon",ref:r,"aria-labelledby":a},d),n?i.createElement("title",{id:a},n):null,i.createElement("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M16.5 6v.75m0 3v.75m0 3v.75m0 3V18m-9-5.25h5.25M7.5 15h3M3.375 5.25c-.621 0-1.125.504-1.125 1.125v3.026a2.999 2.999 0 0 1 0 5.198v3.026c0 .621.504 1.125 1.125 1.125h17.25c.621 0 1.125-.504 1.125-1.125v-3.026a2.999 2.999 0 0 1 0-5.198V6.375c0-.621-.504-1.125-1.125-1.125H3.375Z"}))}const Se=i.forwardRef(Ce),ae={createOrder:async n=>{try{return(await F.post("/payments/create-order",n)).data.data}catch(a){throw new Error(A(a))}},verifyPayment:async n=>{try{return(await F.post("/payments/verify",n)).data.data}catch(a){throw new Error(A(a))}}},Pe={validateCoupon:async n=>{try{return(await F.post("/coupons/validate",{couponCode:n})).data.data}catch(a){throw new Error(A(a))}},getCouponUsage:async n=>{try{return(await F.get(`/coupons/usage?couponCode=${encodeURIComponent(n)}`)).data.data}catch(a){throw new Error(A(a))}}},T=["JavaScript","TypeScript","React","Angular","Vue.js","Node.js","Python","Java","C++","Go","Rust","Ruby","System Design","Data Structures","Algorithms","Database Design","AWS","Azure","GCP","Docker","Kubernetes","DevOps","Machine Learning","Data Science","AI/ML","Frontend","Backend","Full Stack","Mobile Development","REST API","GraphQL","Microservices","SQL","MongoDB","PostgreSQL","Redis","Behavioral","HR Interview","Leadership"],Ge=()=>{const n=pe(),a=xe(),{user:d}=ye(),[r,k]=i.useState([]),K=30,[B,ie]=i.useState(""),[m,C]=i.useState(""),[Q,U]=i.useState(!1),[S,O]=i.useState(""),[t,P]=i.useState(null),[H,Y]=i.useState(!1),[W,y]=i.useState(null),q=T.filter(s=>s.toLowerCase().includes(m.toLowerCase())&&!r.includes(s)),R=he({queryKey:["interview-payment-check"],queryFn:()=>se.checkPaymentRequirement()}),ne=ee({mutationFn:s=>Pe.validateCoupon(s),onSuccess:s=>{s.valid&&s.coupon?(P({code:s.coupon.code,remainingUses:s.remainingUses,description:s.coupon.description,discountType:s.coupon.discountType||"percentage",discountValue:s.coupon.discountValue||0}),y(null),c.success(s.message)):(P(null),y(s.message),c.error(s.message))},onError:s=>{P(null),y(s.message),c.error(s.message)}}),M=ee({mutationFn:s=>se.createInterviewRequest({requestedSkills:r,preferredDuration:K,notes:B||void 0,paymentId:s==null?void 0:s.paymentId,couponCode:s==null?void 0:s.couponCode}),onSuccess:()=>{c.success("Interview request submitted! You will be notified when an interviewer accepts."),a.invalidateQueries({queryKey:["my-interviews"]}),a.invalidateQueries({queryKey:["my-interview-requests"]}),n("/dashboard/interviews")},onError:s=>{c.error(s.message||"Failed to submit interview request")}}),oe=()=>new Promise((s,o)=>{if(window.Razorpay){s();return}const l=document.createElement("script");l.src="https://checkout.razorpay.com/v1/checkout.js",l.onload=()=>s(),l.onerror=()=>o(new Error("Failed to load Razorpay SDK")),document.body.appendChild(l)}),le=async()=>{const s=R.data,o=(s==null?void 0:s.pricePerInterview)??100;let l=o;t&&(t.discountType==="percentage"?l=o*(1-t.discountValue/100):l=Math.max(0,o-t.discountValue));const w=Math.max(100,Math.round(l*100)),v="rzp_live_S77bquvNBiSN0h",u=await ae.createOrder({amount:w,notes:{reason:"mock_interview_request",...t&&{couponCode:t.code}}});return await oe(),new Promise((ue,E)=>{if(!window.Razorpay){E(new Error("Razorpay SDK not available"));return}let L="Mock interview booking";t&&(t.discountType==="percentage"?L=`Mock interview booking - ${t.discountValue}% discount applied (Coupon: ${t.code})`:L=`Mock interview booking - â‚¹${t.discountValue} discount applied (Coupon: ${t.code})`);const X=new window.Razorpay({key:v,amount:w,currency:u.currency,name:"Mockomi",description:L,order_id:u.orderId,handler:async x=>{try{const b=await ae.verifyPayment({razorpay_order_id:x.razorpay_order_id,razorpay_payment_id:x.razorpay_payment_id,razorpay_signature:x.razorpay_signature});ue(b._id)}catch(b){E(b)}},prefill:{name:`${(d==null?void 0:d.firstName)??""} ${(d==null?void 0:d.lastName)??""}`.trim(),email:(d==null?void 0:d.email)||""},notes:u!=null&&u.paymentId?{paymentId:u.paymentId}:void 0,theme:{color:"#0ea5e9"},modal:{ondismiss:()=>{E(new Error("Payment was cancelled. Interview request was not created."))}}});X.on("payment.failed",x=>{var b;E(new Error(((b=x==null?void 0:x.error)==null?void 0:b.description)||"Payment failed. Interview request was not created."))}),X.open()})},G=s=>{const o=s.trim();o&&(r.includes(o)?k(r.filter(l=>l!==o)):k([...r,o]))},z=()=>{const s=m.trim();if(!s){c.error("Please enter a skill name");return}if(r.includes(s)){c.error("This skill is already selected");return}k([...r,s]),C(""),c.success(`Added "${s}" as a custom skill`)},ce=()=>{k([]),C("")},J=()=>{C("")},$=m.trim()&&!r.includes(m.trim())&&!T.map(s=>s.toLowerCase()).includes(m.trim().toLowerCase()),Z=async()=>{if(!S.trim()){c.error("Please enter a coupon code");return}Y(!0),y(null),await ne.mutateAsync(S.trim().toUpperCase()),Y(!1)},de=()=>{P(null),O(""),y(null)},me=async()=>{if(r.length===0){c.error("Please select at least one skill for your interview");return}const s=R.data,o=(s==null?void 0:s.pricePerInterview)??100;let l=!1;if(t&&(t.discountType==="percentage"?l=t.discountValue>=100:l=t.discountValue>=o),t&&l){try{await M.mutateAsync({couponCode:t.code})}catch{}return}let w;try{if(U(!0),w=await le(),!w)throw new Error("Payment verification failed");c.success("Payment successful! Creating interview request..."),await M.mutateAsync({paymentId:w,...t&&{couponCode:t.code}})}catch(v){const u=(v==null?void 0:v.message)||"Payment was cancelled or failed";u.includes("cancelled")?c.error("Payment cancelled. Interview request was not created. Please try again when ready."):u.includes("failed")?c.error(u):c.error(u);return}finally{U(!1)}},V=R.data,p=(V==null?void 0:V.pricePerInterview)??100;let g=p,f=!1;return t&&(t.discountType==="percentage"?(g=p*(1-t.discountValue/100),f=t.discountValue>=100):(g=Math.max(0,p-t.discountValue),f=t.discountValue>=p)),e.jsx(ge,{children:e.jsxs("div",{className:"max-w-4xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Request Mock Interview"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Select the skills you want to be interviewed on. An expert interviewer will pick up your request."})]}),e.jsx(j,{className:"mb-8 bg-gradient-to-r from-blue-50 to-indigo-50 border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(fe,{className:"h-6 w-6 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-blue-900",children:"How It Works"}),e.jsxs("ol",{className:"list-decimal list-inside text-blue-700 mt-2 space-y-1 text-sm",children:[e.jsx("li",{children:"Select the skills/topics you want to practice"}),e.jsx("li",{children:"Choose your preferred interview duration"}),e.jsx("li",{children:"Apply a coupon code or complete payment"}),e.jsx("li",{children:"Submit your request"}),e.jsx("li",{children:"An expert interviewer matching your skills will claim your request"}),e.jsx("li",{children:"You'll receive a notification with the scheduled time"})]})]})]})}),e.jsx(j,{className:"mb-8 bg-gradient-to-r from-purple-50 to-pink-50 border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:e.jsx(Se,{className:"h-6 w-6 text-purple-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-purple-900 mb-3",children:"Have a Coupon Code?"}),t?e.jsx(h.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},className:"p-4 bg-white rounded-lg border-2 border-green-200 shadow-sm",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("div",{className:"p-2 bg-green-100 rounded-lg",children:e.jsx(we,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-gray-900",children:t.code}),e.jsx("p",{className:"text-sm text-gray-600 mt-1",children:t.description}),e.jsxs("p",{className:"text-sm text-green-600 font-medium mt-2",children:[t.remainingUses," use",t.remainingUses!==1?"s":""," remaining"]})]})]}),e.jsx("button",{onClick:de,className:"text-gray-400 hover:text-gray-600 transition-colors",children:e.jsx(I,{className:"h-5 w-5"})})]})}):e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx(te,{placeholder:"Enter coupon code (e.g., INTERVIEW50)",value:S,onChange:s=>{O(s.target.value.toUpperCase()),y(null)},onKeyPress:s=>{s.key==="Enter"&&Z()},className:"flex-1 uppercase"}),e.jsx(N,{onClick:Z,isLoading:H,disabled:!S.trim()||H,children:"Apply"})]}),W&&e.jsx(h.div,{initial:{opacity:0,y:-10},animate:{opacity:1,y:0},className:"p-3 bg-red-50 border border-red-200 rounded-lg text-red-700 text-sm",children:W})]})]})]})}),e.jsx(j,{className:"mb-8 bg-primary-50 border-primary-200",children:e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"p-3 bg-primary-100 rounded-lg",children:e.jsx(ve,{className:"h-6 w-6 text-primary-600"})}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"font-semibold text-primary-900",children:"Pricing Information"}),t&&!f?e.jsxs("div",{className:"mt-2 space-y-1",children:[e.jsxs("p",{className:"text-primary-700",children:[e.jsxs("span",{className:"line-through text-gray-500",children:["â‚¹",p]})," ",e.jsxs("span",{className:"font-semibold text-green-600",children:["â‚¹",Math.round(g)]})," ","(",t.discountType==="percentage"?`${t.discountValue}% off`:`â‚¹${t.discountValue} off`,")"]}),e.jsxs("p",{className:"text-sm text-primary-600",children:["You save â‚¹",Math.round(p-g),"!"]})]}):t&&f?e.jsx("p",{className:"text-green-700 font-semibold mt-1",children:"ðŸŽ‰ This interview is FREE with your coupon!"}):e.jsxs("p",{className:"text-primary-700 mt-1",children:["Each interview costs â‚¹",p,". Apply a coupon code above for discounts!"]})]})]})}),e.jsxs(j,{className:"mb-6 p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Select Interview Topics *"}),r.length>0&&e.jsxs(N,{type:"button",variant:"outline",size:"sm",onClick:ce,className:"text-gray-600",children:[e.jsx(I,{className:"h-4 w-4 mr-1"}),"Clear All"]})]}),r.length>0&&e.jsxs(h.div,{initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},className:"mb-6 p-4 bg-primary-50 rounded-xl border border-primary-200",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsxs("p",{className:"text-sm font-medium text-primary-900 flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Selected Skills (",r.length,")"]})}),e.jsx("div",{className:"flex flex-wrap gap-2",children:r.map(s=>e.jsxs(h.button,{type:"button",initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},whileHover:{scale:1.05},onClick:()=>G(s),className:"inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-primary-600 text-white hover:bg-primary-700 transition-colors cursor-pointer shadow-sm",children:[s,e.jsx(I,{className:"h-4 w-4 ml-1.5"})]},s))})]}),e.jsxs("div",{className:"mb-4 relative",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx(te,{type:"text",placeholder:"Search skills or add custom skills...",value:m,onChange:s=>C(s.target.value),onKeyPress:s=>{s.key==="Enter"&&$&&(s.preventDefault(),z())},className:"pl-10 pr-10"}),m&&e.jsxs("div",{className:"absolute right-3 top-1/2 transform -translate-y-1/2 flex items-center gap-2",children:[$&&e.jsx("button",{type:"button",onClick:z,className:"text-primary-600 hover:text-primary-700 font-medium text-sm flex items-center gap-1",title:"Add as custom skill",children:e.jsx(D,{className:"h-5 w-5"})}),e.jsx("button",{type:"button",onClick:J,className:"text-gray-400 hover:text-gray-600",children:e.jsx(I,{className:"h-4 w-4"})})]})]}),$&&e.jsxs(h.p,{initial:{opacity:0,y:-5},animate:{opacity:1,y:0},className:"mt-2 text-sm text-primary-600 flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),'Press Enter or click + to add "',m.trim(),'" as a custom skill']})]}),q.length>0?e.jsxs("div",{className:"space-y-3",children:[e.jsxs("p",{className:"text-sm text-gray-600",children:["Available skills (",q.length,")"]}),e.jsx("div",{className:"flex flex-wrap gap-2 max-h-80 overflow-y-auto p-3 bg-gray-50 rounded-lg border border-gray-200",children:q.map((s,o)=>e.jsxs(h.button,{type:"button",initial:{opacity:0,y:10},animate:{opacity:1,y:0},transition:{delay:o*.01},onClick:()=>G(s),className:"inline-flex items-center px-3 py-1.5 rounded-full text-sm font-medium bg-white text-gray-800 hover:bg-primary-50 hover:text-primary-700 hover:border-primary-300 border border-gray-200 transition-all cursor-pointer shadow-sm",children:[s,e.jsx("span",{className:"ml-1.5 text-primary-600",children:"+"})]},s))})]}):e.jsx(h.div,{initial:{opacity:0},animate:{opacity:1},className:"text-center py-12 bg-gray-50 rounded-lg border-2 border-dashed border-gray-300",children:r.length===T.length?e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-green-500 mb-4"}),e.jsx("p",{className:"text-gray-900 font-medium mb-1",children:"All skills selected!"}),e.jsx("p",{className:"text-sm text-gray-600",children:"You've selected all available skills. Remove some to see more options."})]}):m?e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-900 font-medium mb-1",children:"No matching skills found"}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:['"',m,'" is not in our predefined list. You can add it as a custom skill!']}),e.jsxs("div",{className:"flex gap-2 justify-center",children:[e.jsxs(N,{type:"button",onClick:z,className:"flex items-center gap-2",children:[e.jsx(D,{className:"h-4 w-4"}),'Add "',m,'" as Custom Skill']}),e.jsx(N,{type:"button",variant:"outline",size:"sm",onClick:J,children:"Clear Search"})]})]}):e.jsxs(e.Fragment,{children:[e.jsx(_,{className:"h-12 w-12 mx-auto text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-900 font-medium mb-1",children:"No skills available"}),e.jsx("p",{className:"text-sm text-gray-600",children:"All skills have been selected. Remove some skills above to see more options."})]})})]}),e.jsxs(j,{className:"mb-6 p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Additional Notes (Optional)"}),e.jsx("textarea",{placeholder:"Any specific areas you want to focus on, your experience level, or other preferences...",value:B,onChange:s=>ie(s.target.value),rows:4,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-primary-500"})]}),e.jsx(j,{className:"p-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-900",children:[r.length," skill",r.length!==1?"s":""," selected"]}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Duration: ",K," minutes"]}),t&&e.jsxs("p",{className:"text-sm text-green-600 font-medium mt-1 flex items-center gap-1",children:[e.jsx(be,{className:"h-4 w-4"}),"Coupon applied: ",t.code,!f&&e.jsxs("span",{className:"ml-2",children:["(â‚¹",Math.round(g)," after ",t.discountType==="percentage"?`${t.discountValue}%`:`â‚¹${t.discountValue}`," discount)"]})]})]}),e.jsxs(N,{size:"lg",onClick:me,isLoading:M.isPending||Q,disabled:r.length===0||Q||R.isLoading,children:[e.jsx(je,{className:"h-5 w-5 mr-2"}),t&&f?"Submit Interview Request (Free)":t?`Submit Interview Request (â‚¹${Math.round(g)})`:`Submit Interview Request (â‚¹${p})`]})]})}),e.jsxs("div",{className:"mt-6 flex items-center gap-3 text-gray-600 bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx(Ne,{className:"h-5 w-5 text-green-500 flex-shrink-0"}),e.jsx("p",{className:"text-sm",children:"Once submitted, matching interviewers will see your request and can claim it. You'll be notified immediately when scheduled."})]})]})})};export{Ge as default};
